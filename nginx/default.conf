server {
    listen       80;
    server_name  localhost;

    # OpenAI API (ローカル中継)
    # ブラウザから api.openai.com を直叩きするとCORSでブロックされるため、
    # 同一オリジン(/openai/*)で受けてOpenAIへ転送する。
    location /openai/ {
        resolver 127.0.0.11 ipv6=off valid=30s;
        set $openai_host api.openai.com;
        rewrite ^/openai/(.*) /$1 break;
        proxy_pass https://$openai_host;
        proxy_ssl_server_name on;

        proxy_set_header Host $openai_host;
        proxy_set_header Authorization $http_authorization;

        # ストリーミング(SSE)向け
        proxy_http_version 1.1;
        proxy_buffering off;
        proxy_request_buffering off;
        proxy_read_timeout 300s;
    }

    # JS/CSS ファイルはキャッシュを無効化（開発中のブラウザキャッシュ問題を防止）
    location ~* \.(js|css)$ {
        root   /usr/share/nginx/html;
        charset utf-8;
        add_header Cache-Control "no-cache, must-revalidate";
        add_header Pragma "no-cache";
        etag on;
    }

    location / {
        root   /usr/share/nginx/html;
        index  index.html index.htm;
        charset utf-8;
    }

    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /usr/share/nginx/html;
    }
}
